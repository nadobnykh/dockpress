var _feedHolder;function wppfm_editCategories(){var d=jQuery("#category-selector-lvl");if(!wppfm_isCustomChannel(_feedHolder.channel)){var e=_feedHolder.mainCategory.split(" > ");var c=e.length;var a=jQuery("#lvl_"+(c)).html()!==""?c+1:c;jQuery("#selected-categories").hide();jQuery("#lvl_0").prop("disabled",false);for(var b=0;b<a;b++){var f=jQuery("#lvl_"+b);if(!e[b]){f.val("0")}f.show()}}else{d.html(wppfm_freeCategoryInputCntrl("default",_feedHolder.feedId,_feedHolder.mainCategory));d.prop("disabled",false)}}function wppfm_generateFeed(){if(jQuery("#file-name").val()!==""){if(_feedHolder.categoryMapping&&_feedHolder.categoryMapping.length>0){wppfm_generateAndSaveFeed()}else{var a=confirm(wppfm_feed_settings_form_vars.no_category_selected);if(a===true){wppfm_generateAndSaveFeed()}}}else{jQuery("#alert-message").html("<p>"+wppfm_feed_settings_form_vars.file_name_required+"</p>");jQuery("#success-message").show()}}function wppfm_saveFeedData(){if(jQuery("#file-name").val()!==""){wppfm_saveFeed()}else{jQuery("#alert-message").html("<p>"+wppfm_feed_settings_form_vars.file_name_required+"</p>");jQuery("#success-message").show()}}function getCombinedValue(g,f){var h=1;var b="";var d=_feedHolder.getCombinedOutputValue(g,f);while(jQuery("#combined-input-field-cntrl-"+g+"-"+f+"-"+h).val()){var a=g+"-"+f+"-"+h;var e=jQuery("#combined-input-field-cntrl-"+a).val();b+=h>1?jQuery("#combined-separator-cntrl-"+a).val()+"#":"";if(e!=="static"){b+=e!=="select"?e+"|":""}else{if(jQuery("#static-input-field-"+a).val()){b+=e+"#"+jQuery("#static-input-field-"+a).val()+"|"}else{b=d+"|";break}}h++}b=b.substring(0,b.length-1);return h>1?b:false}function wppfm_staticValueChanged(c,b,a){if(a>0){wppfm_changedCombinedOutput(c,b,a)}else{wppfm_setStaticValue(c,b,a);if(c===34){wppfm_setIdentifierExistsDependancies()}}}function wppfm_changedOutputSelection(b){var a=jQuery("#output-field-cntrl-"+b);if(a.val()!=="no-value"){wppfm_activateOptionalFieldRow(b,a.val())}}function wppfm_hasExtraSourceRow(a,b){if(b.length>0){return b[a-1].hasOwnProperty("c")}else{return false}}function wppfm_changedCustomOutputTitle(){var a=jQuery("#custom-output-title-input").val();if(a){wppfm_activateCustomFieldRow(a)}}function wppfm_deleteSpecificFeed(c,b){var a=confirm(wppfm_feed_list_form_vars.confirm_delete_feed.replace("%feedname%",b));if(a===true){wppfm_deleteFeed(c,b);console.log("File "+b+" removed from server.");wppfm_show_success_message(wppfm_feed_list_form_vars.feed_removed.replace("%feedname%",b))}}function wppfm_alertRemoveChannel(){var a=confirm(wppfm_manage_channels_vars.confirm_removing_channel);if(true!==a){return false}}function wppfm_valueOptionChanged(d,c,e){var b=jQuery("#value-options-"+d+"-"+c+"-"+e).val();var a=wppfm_getCorrectValueSelector(d,c,0,b,"","");jQuery("#value-editor-input-span-"+d+"-"+c+"-"+e).html(a)}function wppfm_getCorrectValueSelector(f,e,g,c,d,a){var b="";switch(c){case"0":case"change nothing":wppfm_valueInputOptionsChanged(f,e,g);b="";break;case"1":case"overwrite":b=wppfm_valueOptionsSingleInput(f,e,g,d);break;case"2":case"replace":b=wppfm_valueOptionsReplaceInput(f,e,g,d,a);break;case"3":case"remove":case"4":case"add prefix":case"5":case"add suffix":b=wppfm_valueOptionsSingleInputValue(f,e,g,d);break;case"6":case"recalculate":b=wppfm_valueOptionsRecalculate(f,e,g,d,a);break;case"7":case"convert to child-element":b=wppfm_valueOptionsElementInput(f,e,g,d);break;default:b=wppfm_valueOptionsSingleInput(f,e,g,d);break}return b}function wppfm_deactivateFeed(a){wppfm_switchFeedStatus(a,function(b){wppfm_updateFeedRowStatus(a,parseInt(b))})}function wppfm_duplicateFeed(b,a){wppfm_duplicateExistingFeed(b,function(c){if(c){wppfm_show_success_message(wppfm_feed_list_form_vars.added_feed_copy.replace("%feedname%",a))}})}function wppfm_regenerateFeed(a){var b=wppfmQueueStringIsEmpty()?3:4;wppfmAddToQueueString(a);wppfm_show_feed_spinner();wppfm_updateFeedRowStatus(a,b);console.log("started "+a);wppfm_updateFeedFile(a,function(d){wppfm_hide_feed_spinner();console.log(d);var c=setInterval(function(){wppfm_getCurrentFeedStatus(a,function(f){var e=JSON.parse(f);if("3"!==e.status_id&&"4"!==e.status_id){console.log(e);wppfm_resetFeedStatus(e);wppfm_resetFeedList();clearInterval(c);wppfmRemoveFromQueueString(a)}})},5000)})}function wppfm_viewFeed(a){window.open(a)}function wppfm_addRowValueEditor(c,b,d,a){jQuery("#end-row-id-"+c).remove();jQuery("#row-"+c).append(wppfm_valueEditor(c,b,d,a)+wppfm_endrow(c));jQuery("#value-editor-input-query-add-span-"+c+"-"+b+"-"+d).remove()}function wppfm_convertToCamelCase(b){var a=b[0].toLowerCase();for(var c=1;c<b.length;c++){a+=b[c].charAt(0).toUpperCase()+b[c].slice(1)}return a}function wppfm_getFeedObject(a,b){wppfm_getFeedData(a,function(c){if("0"!==c){var e=JSON.parse(c)[0];var d=new Feed(e.product_feed_id,e.title,e.include_variations,e.is_aggregator,e.channel,e.main_category,e.category_mapping,e.url,e.source,e.country,e.language,e.feed_title,e.feed_description,e.schedule,[],e.status_id,"1");b(d)}else{b(0)}})}function wppfm_addValueEditorQuery(c,b,a){if(wppfm_changeValueIsFilled(c,b,a)){if(wppfm_queryIsFilled(c,(b-1),1)){wppfm_showEditValueQuery(c,b,a,true)}else{alert(wppfm_feed_settings_form_vars.query_requirements)}}else{alert(wppfm_feed_settings_form_vars.first_fill_in_change_value)}}function wppfm_queryStringToQueryObject(c){var b={};if(c){for(var a in c){b=wppfm_convertQueryStringToQueryObject(c[a])}}return b}function wppfm_valueStringToValueObject(b){var a={};if(b){for(var c in b){if(c!=="q"){a=wppfm_convertValueStringToValueObject(b[c])}}}return a}function wppfm_convertQueryStringToQueryObject(c){var b={};var a=c.split("#");if(a[0]==="1"||a[0]==="2"){b.preCondition=a[0]}else{b.preCondition="0"}b.source=a[1];b.condition=a[2];b.value=a[3]?a[3]:"";b.endValue=a[5]?a[5]:"";return b}function wppfm_resortObject(b){var a=[];var e=1;for(var d in b){var f={};for(var c in b[d]){if(c!=="q"){f[e]=b[d][c];a.push(f)}else{a[e-1].q=b[d][c]}}e++}return e>1?a:""}function wppfm_convertValueStringToValueObject(b){var a={};var c=b.split("#");a.preCondition=c[0];a.condition=c[1];a.value=c[2];a.endValue=c[3]?c[3]:"";return a}function wppfm_makeCleanQueryObject(){var a={};a.preCondition="if";a.source="select";a.condition="";a.value="";a.endValue="";return a}function wppfm_makeCleanValueObject(){var a={};a.preCondition="change";a.condition="overwrite";a.value="";a.endValue="";return a}function wppfm_addNewItemToCategoryString(h,a,f,e){var b=a.split(e).length;if(a===wppfm_feed_settings_form_vars.map_to_default_category||h==="0"){return f}else{if(b<=h){return a+e+f}else{var g=0;for(var c=0;c<h;c++){g=a.indexOf(e,g+1);var d=a.substring(0,g)}return d+e+f}}};