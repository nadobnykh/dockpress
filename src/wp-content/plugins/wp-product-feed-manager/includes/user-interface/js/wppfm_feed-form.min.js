var _mandatoryFields=[];var _highlyRecommendedFields=[];var _recommendedFields=[];var _undefinedRecommendedOutputs=[];var _definedRecommendedOutputs=[];var _optionalFields=[];var _undefinedOptionalOutputs=[];var _definedOptionalOutputs=[];var _undefinedCustomOutputs=[];var _customFields=[];var _inputFields=[];var _feedHolder=[];function wppfm_mainInputChanged(c){var b=jQuery("#merchants").val();var a=_feedHolder.feedId;wppfm_reactOnChannelInputChanged(b,a,c)}function wppfm_validateFileName(a){if(!wppfm_contains_special_characters(a.val())){_feedHolder.title=a.val()}else{alert(wppfm_feed_settings_form_vars.prohibited_feed_name_characters);a.val("")}}function wppfm_freeCategoryChanged(a,b){if(a==="default"){if(b){if(b>0){_feedHolder.setCustomCategory(undefined,jQuery("#free-category-text-input").val())}else{wppfm_mainInputChanged(true)}}else{wppfm_mainInputChanged(true)}}else{_feedHolder.changeCustomFeedCategoryMap(b,jQuery("#feed-category-"+b+" :input").val())}}function wppfm_constructNewFeed(){var h=jQuery("#days-interval");var t=jQuery("#update-schedule-hours");var f=jQuery("#update-schedule-minutes");var g=jQuery("#update-schedule-frequency");var x=jQuery("#file-name").val();var k="1";var c=jQuery("#lvl_0 option:selected").text();var v=[];var y=jQuery("#merchants").val();var d=jQuery("#variations").is(":checked")?1:0;var l=jQuery("#aggregator").is(":checked")?1:0;var o=jQuery("#countries").val();var n=document.getElementById("language")===null?"":jQuery("#language").val();var w=jQuery("#google-feed-title-selector").val();var j=jQuery("#google-feed-description-selector").val();var i=h.val()!==""?h.val():"1";var r=t.val()!==""?t.val():"00";var q=f.val()!==""?f.val():"00";var e=g.val()!==""?g.val():"1";var p=[];var m=2;var s=wppfm_getChannelFeedType(y);var u="1";var a=jQuery("#wp-plugin-url").text()+"/wppfm-feeds/"+x+"."+s;var b=i+":"+r+":"+q+":"+e;wppfm_setScheduleSelector(i,e);_feedHolder=new Feed(-1,x,d,l,parseInt(y),c,v,a,k,o,n,w,j,b,p,m,u)}function wppfm_constructNewSpecialFeed(a){_feedHolder=a}function wppfm_setSpecialFeedProperty(a,c,b){if(_feedHolder.hasOwnProperty(a)){if("object"===typeof _feedHolder[a]){_feedHolder[a].push(c)}else{_feedHolder[a]=c}}else{if("array"===b){_feedHolder[a]=[];_feedHolder[a].push(c)}else{_feedHolder[a]=c}}}function wppfm_unsetSpecialFeedArrayProperty(b,c){if(_feedHolder.hasOwnProperty(b)&&"object"===typeof _feedHolder[b]){var a=_feedHolder[b].indexOf(c);_feedHolder[b].splice(a,1)}}function wppfm_finishOrUpdateFeedPage(d){var c=jQuery("#merchants");var b=jQuery("#lvl_0");var a=c.val().toString();wppfm_show_feed_spinner();_feedHolder.title=jQuery("#file-name").val();_feedHolder.channel=c.val();_feedHolder.includeVariations=jQuery("#variations").is(":checked")?"1":"0";_feedHolder.isAggregator=jQuery("#aggregator").is(":checked")?"1":"0";_feedHolder.feedTitle=jQuery("#google-feed-title-selector").val();_feedHolder.feedDescription=jQuery("#google-feed-description-selector").val();_feedHolder.language=document.getElementById("language")===null?"":jQuery("#language").val();wppfm_getFeedAttributes(-1,a,function(e){_feedHolder.setUpdateSchedule(jQuery("#days-interval").val(),jQuery("#update-schedule-hours").val(),jQuery("#update-schedule-minutes").val(),jQuery("#update-schedule-frequency").val());if(undefined===_feedHolder.attributes||0===_feedHolder.attributes.length){wppfm_addFeedAttributes(e,a,1)}wppfm_customSourceFields(_feedHolder.dataSource,function(f){_feedHolder.country=jQuery("#countries").val();_feedHolder.language=jQuery("#language").val();wppfm_fillSourcesList(f);wppfm_mainFeedFilters(_feedHolder.feedId,function(j){var i=j!==1?j:null;var h="0"!==_feedHolder.country?_feedHolder.country:_feedHolder.language;_feedHolder.setFeedFilter(i);_feedHolder=wppfm_setOutputAttributeLevels(a,_feedHolder,h);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);if(d){_feedHolder.mainCategory=b.val()?b.val():jQuery("#free-category-text-input").val();_feedHolder.setMainCategory("lvl_0",b.val(),a)}wppfm_makeFieldsTable();if(_feedHolder!==0){var g=_feedHolder.feedId===-1;wppfm_fillFeedFields(g,d)}console.log(_feedHolder);_feedHolder.channel=a;jQuery("#page-center-buttons").show();jQuery("#page-bottom-buttons").show();wppfm_hide_feed_spinner()})})})}function wppfm_finishOrUpdateSpecialFeedPage(b){_feedHolder=b;wppfm_makeFieldsTable();if(_feedHolder!==0){var a=_feedHolder.feedId===-1;wppfm_fillFeedFields(a,false)}jQuery("#page-center-buttons").show();jQuery("#page-bottom-buttons").show()}function wppfm_editExistingFeed(a){wppfm_show_feed_spinner();wppfm_getFeedObject(a,function(e){_feedHolder=e;console.log(_feedHolder.categoryMapping);var c=_feedHolder.channel;var b=_feedHolder.mainCategory;var d=b&&b.indexOf(" > ")>-1?b.substring(0,b.indexOf(" > ")):b;wppfm_fillCategoryVariables(c,d,"0");wppfm_getFeedAttributes(_feedHolder.feedId,c,function(f){wppfm_addFeedAttributes(f,c,1);wppfm_customSourceFields(_feedHolder.dataSource,function(g){wppfm_fillSourcesList(g);wppfm_mainFeedFilters(a,function(j){var i=j!==1?j:null;var h=!wppfm_requiresLanguageInput(c)?_feedHolder.country:_feedHolder.language;_feedHolder.setFeedFilter(i);_feedHolder=wppfm_setOutputAttributeLevels(c,_feedHolder,h);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);wppfm_makeFieldsTable();if(_feedHolder!==0){wppfm_fillFeedFields(false,false)}if(_feedHolder.categoryMapping){wppfm_setCategoryMap(_feedHolder.categoryMapping)}wppfm_enableFeedActionButtons();jQuery("#countries").prop("disabled",false);wppfm_fillDefaultCategorySelectors();wppfm_setIdentifierExistsDependancies();jQuery("div").filter("#page-center-buttons").show();jQuery("#page-bottom-buttons").show();wppfm_hide_feed_spinner()})})})})}function wppfm_fillSourcesList(a){_inputFields=wppfm_woocommerceSourceOptions();wppfm_addCustomFieldsToInputFields(_inputFields,a);_inputFields.sort(function(d,c){return(""+d.label).toUpperCase()<(""+c.label).toUpperCase()?-1:1})}function wppfm_saveUpdateSchedule(){var d=jQuery("#days-interval").val();var a=jQuery("#update-schedule-hours").val();var b=jQuery("#update-schedule-minutes").val();var c=jQuery("#update-schedule-frequency").val();if(d!=="1"){c="1"}if(c===1){d="1"}wppfm_setScheduleSelector(d,c);_feedHolder.setUpdateSchedule(d,a,b,c)}function wppfm_setScheduleSelector(e,d){var c=jQuery("#wppfm-update-frequency-wrapper");var b=jQuery("#wppfm-update-day-wrapper");var a=jQuery("#wppfm-update-every-day-wrapper");if(e==="1"){c.show()}else{c.hide()}if(d>1){b.hide();a.show()}else{b.show();a.hide()}}function wppfm_addCustomFieldsToInputFields(b,d){if(d!=="0"){for(var a=0;a<d.length;a++){var c={value:d[a].attribute_name,label:d[a].attribute_label,prop:"custom"};b.push(c)}}}function wppfm_fillDefaultCategorySelectors(){var b=_feedHolder.mainCategory;var a=_feedHolder.channel;var c=wppfm_channelCountryCode(a);wppfm_getCategoryListsFromString(a,b,c,function(f){var d=JSON.parse(f);if(d&&d.length>0&&b!==undefined){var e=b.split(" > ");for(var h=0;h<d.length;h++){jQuery("#lvl_"+h).append(wppfm_categorySelectCntrl(d[h]));var g=document.getElementById("lvl_"+h);g.value=e[h]}}else{jQuery("#lvl_0").prop("disabled",false)}})}function wppfm_setGoogleFeedTitle(a){_feedHolder.feedTitle=a}function wppfm_setGoogleFeedDescription(a){_feedHolder.feedDescription=a}function wppfm_setGoogleFeedLanguage(a){_feedHolder.language=a}function wppfm_setCategoryMap(a,f){if(undefined===f){f="mapping"}var d=JSON.parse(a);for(var b=0;b<d.length;b++){var c=d[b].shopCategoryId;var e="";if("mapping"===f){switch(d[b].feedCategories){case"wp_mainCategory":e=wppfm_mapToDefaultCategoryElement(c,"default");break;case"wp_ownCategory":e=wppfm_mapToDefaultCategoryElement(c,"shopCategory");break;default:e=wppfm_mapToCategoryElement(c,d[b].feedCategories);break}}jQuery("#feed-selector-"+c).prop("checked",true);jQuery("#feed-category-"+c).html(e)}}function wppfm_generateAndSaveFeed(){wppfm_show_feed_spinner();_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:wppfm_feed_settings_form_vars.no_category_required;wppfm_saveFeedToDb(_feedHolder,function(b){var a=_feedHolder.feedId===-1;wppfm_handleSaveFeedToDbActionResult(b,a);wppfm_updateFeedFile(_feedHolder.feedId,function(c){wppfm_handleUpdateFeedFileActionResult(c);if(!a){wppfm_hide_feed_spinner()}})})}function wppfm_handleSaveFeedToDbActionResult(b,a){if(0===b||"0"===b){console.log("Saving the data to the data base has failed!");wppfm_show_error_message(wppfm_feed_settings_form_vars.save_data_failed);wppfm_hide_feed_spinner()}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}}function wppfm_handleUpdateFeedFileActionResult(a){var b=jQuery("#error-message");switch(a){case"started_processing":b.hide();wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_started);wppfm_alert_update_finished(_feedHolder.feedId,5000);break;case"pushed_to_queue":b.hide();wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_queued);wppfm_alert_update_finished(_feedHolder.feedId,5000);break;case"writing_error":wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_writing_error);wppfm_hide_feed_spinner();break;case"foreground_processing_complete":wppfm_alert_update_finished(_feedHolder.feedId,0);wppfm_hide_feed_spinner();break;case"activation_error":wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_initiation_error);wppfm_hide_feed_spinner();break;case"1":case 1:wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_general_error.replace("%xmlResult%",a));wppfm_hide_feed_spinner();break;default:wppfm_hide_feed_spinner()}}function wppfm_alert_update_finished(b,c){if(undefined===c||0===c){c=5000}var e=window.setInterval(d,c,b);var a=jQuery("#success-message");if(!b){return false}function d(f){wppfm_getCurrentFeedStatus(f,function(g){var h=JSON.parse(g);console.log("Feed status changed to status "+h.status_id);switch(h.status_id){case"0":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_unknown.replace("%feedname%",h.title));window.clearInterval(e);break;case"1":case"2":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_ready.replace("%feedname%",h.title).replace("%prodnr%",h.products));window.clearInterval(e);break;case"3":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_still_processing);break;case"4":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_added_to_queue);break;case"5":a.hide();wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_status_error.replace("%feedname%",h.title));window.clearInterval(e);break;case"6":a.hide();wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_status_failed.replace("%feedname%",h.title));window.clearInterval(e);break}})}}function wppfm_saveFeed(){wppfm_show_feed_spinner();var a=_feedHolder.feedId===-1;_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:wppfm_feed_settings_form_vars.no_category_required;if(a){_feedHolder.url=wppfm_feed_settings_form_vars.no_feed_generated}wppfm_saveFeedToDb(_feedHolder,function(b){if(b===0){console.log("Saving the data to the data base has failed!");wppfm_show_error_message(wppfm_feed_settings_form_vars.save_data_failed)}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}wppfm_hide_feed_spinner()})}function wppfm_nextCategory(b){var c=wppfm_incrementLast(b);var f=c.match(/(\d+)$/)[0];var e=jQuery("#"+b).val();var d=_feedHolder.channel?_feedHolder.channel.toString():jQuery("#merchants").val();var g=wppfm_channelCountryCode(d);var a=jQuery("#"+c);if(f>1){wppfm_show_feed_spinner()}wppfm_hideSubs(b);wppfm_fillCategoryVariables(d,e,b);wppfm_getNextCategories(d,f,e,g,function(h){var i=JSON.parse(h);if(i.length>0){a.append(wppfm_categorySelectCntrl(i));a.show()}if(b.indexOf("catmap")>-1){wppfm_setChildCategories(b,e)}else{_feedHolder.setMainCategory(b,e,d);if(_feedHolder.attributes.length>0&&_feedHolder.attributes[3]["value"]!==undefined&&_feedHolder.attributes[3]["value"]!==""){jQuery("#category-source-string").html(JSON.parse(_feedHolder.attributes[3]["value"]).t)}else{jQuery("#category-source-string").html(_feedHolder.mainCategory)}}if(f>1){wppfm_hide_feed_spinner()}})}function wppfm_setChildCategories(c,f){var e=c.match(/(\d+)$/)[0];var g=c.replace("_"+e,"");var d=g.match(/(\d+)$/)[0];var b=wppfm_getCategoryChildren(d);for(var a=0;a<b.length;a++){wppfm_setChildrenToParentCategory(d,b[a],e,f)}_feedHolder.mapCategory(c,f)}function wppfm_getCategoryChildren(a){var b=jQuery("#feed-selector-"+a);return b.attr("data-children")?JSON.parse(b.attr("data-children")):[]}function wppfm_variation_selection_changed(){alert(wppfm_feed_settings_form_vars.variation_only_for_premium);_feedHolder.changeIncludeVariations(false);jQuery("#variations").prop("checked",false)}function wppfm_aggregatorChanged(){if(jQuery("#aggregator").is(":checked")){_feedHolder.changeAggregator(true);_feedHolder.attributes[8]["fieldLevel"]="1"}else{_feedHolder.changeAggregator(false);_feedHolder.attributes[8]["fieldLevel"]="0";_feedHolder.deactivateAttribute("8")}}function wppfm_setChildrenToParentCategory(k,f,a,d){var l=wppfm_getCategorySelectorValue(f);var c="";var n=wppfm_addNewItemToCategoryString(a,l,d," > ");var o="catmap-"+f+"_"+a;for(var h=0;h<a;h++){c+=jQuery("#catmap-"+k+"_"+h).val()+" > "}var m=c.substring(0,c.length-3);if(l===m||l===wppfm_feed_settings_form_vars.map_to_default_category){if("#category-text-span-"+f.length===0){wppfm_mapToDefaultCategoryElement(f,n)}jQuery("#category-text-span-"+f).text(n);var e=jQuery("#feed-selector-"+f);var b=e.attr("data-children")?JSON.parse(e.attr("data-children")):[];for(var g=0;g<b.length;g++){wppfm_setChildrenToParentCategory(f,b[g],a,d)}_feedHolder.mapCategory(o,d)}else{if(jQuery("#category-text-span-"+f).length===0){jQuery("#feed-category-"+f).html(wppfm_mapToDefaultCategoryElement(f,l));jQuery("#category-selector-catmap-"+f).hide()}}}function wppfm_getCategorySelectorValue(c){var f=jQuery("#category-text-span-"+c).text();if(f===""){var d="";for(var b=0;b<7;b++){var e=jQuery("#catmap-"+c+"_"+b);var a=e.val();if(a!==null&&a!=="0"){d+=e.val()+" > "}}f=d.substring(0,d.length-3)}return f}function wppfm_fillFeedFields(f,c){var g=document.getElementById("language");var j=jQuery("#merchants");if(_feedHolder.mainCategory&&f===false){if(!c){var h=_feedHolder.mainCategory+' (<a class="edit-categories wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="categories" onclick="wppfm_editCategories()">'+wppfm_feed_settings_form_vars.edit+"</a>)";jQuery("#lvl_0").hide();jQuery("#selected-categories").html(h);jQuery("#selected-merchant").html(jQuery("#merchants option[value='"+_feedHolder.channel+"']").text());j.hide()}}else{jQuery("#lvl_0").css("display","initial")}var e=_feedHolder.updateSchedule?_feedHolder.updateSchedule.split(":"):[];if(!f){wppfm_showChannelInputs(_feedHolder.channel,f)}else{jQuery("#category-map").show()}jQuery("#file-name").val(_feedHolder.title);j.val(_feedHolder.channel);jQuery("#variations").prop("checked",_feedHolder.includeVariations>0);jQuery("#aggregator").prop("checked",_feedHolder.isAggregator>0);jQuery("#countries").val(_feedHolder.country);jQuery("#google-feed-title-selector").val(_feedHolder.feedTitle);jQuery("#google-feed-description-selector").val(_feedHolder.feedDescription);jQuery("#days-interval").val(e[0]);if(g!==null){var a=_feedHolder.language!==""?_feedHolder.language:"0";jQuery("#language").val(a)}var d=document.getElementById("update-schedule-hours");var b=document.getElementById("update-schedule-minutes");var i=document.getElementById("update-schedule-frequency");d.value=e[1];b.value=e[2];i.value=e[3]?e[3]:"1";wppfm_setScheduleSelector(e[0],e[3])}function wppfm_categorySelectCntrl(a){var c='<option value="0">'+wppfm_feed_settings_form_vars.select_a_sub_category+"</option>";for(var b=0;b<a.length;b++){c+='<option value="'+a[b]+'">'+a[b]+"</option>"}return c}function wppfm_editCategoryMapping(e){wppfm_show_feed_spinner();var c=_feedHolder.channel;var d=wppfm_channelCountryCode(c);var b=jQuery("#category-text-span-"+e).text();var a=b.split(" > ");if(b&&b!==wppfm_feed_settings_form_vars.map_to_default_category){wppfm_getCategoryListsFromString(c,b,d,function(f){wppfm_showCategoryMappingSelectors(e,JSON.parse(f),a);wppfm_hide_feed_spinner()})}else{if(!wppfm_isCustomChannel(c)){wppfm_getCategoryListsFromString(c,"",d,function(f){wppfm_showCategoryMappingSelectors(e,JSON.parse(f),"");wppfm_hide_feed_spinner()})}else{jQuery("#feed-category-"+e).html(wppfm_freeCategoryInputCntrl("mapping",e,_feedHolder.mainCategory));jQuery("#category-selector-catmap-"+e).hide();wppfm_hide_feed_spinner()}}}function wppfm_showCategoryMappingSelectors(f,c,a){for(var b=0;b<c.length;b++){var e=jQuery("#catmap-"+f+"_"+b);if(c[b]&&c[b].length>0){var d=a[b]?a[b]:"0";e.append(wppfm_categorySelectCntrl(c[b]));e.val(d);e.show()}e.prop("disabled",false)}jQuery("#feed-category-"+f).html("");jQuery("#category-selector-catmap-"+f).show()}function wppfm_activateOptionalFieldRow(f,a){var c=_feedHolder.getAttributeIdByName(a);_feedHolder.activateAttribute(c);if(_feedHolder.attributes[c]["advisedSource"]){_feedHolder.setSourceValue(c,f,_feedHolder.attributes[c]["advisedSource"])}var b=wppfm_fieldRow(_feedHolder.attributes[c],true);var d=-1;if(f===3){d=_undefinedRecommendedOutputs.indexOf(a)}else{if(f===4){d=_undefinedOptionalOutputs.indexOf(a)}}if(d>-1){if(f===3){_undefinedRecommendedOutputs.splice(d,1)}else{if(f===4){_undefinedOptionalOutputs.splice(d,1)}}}if(f===3){_definedRecommendedOutputs.push(_feedHolder.attributes[c]["fieldName"]);_definedRecommendedOutputs.sort()}else{if(f===4){_definedOptionalOutputs.push(_feedHolder.attributes[c]["fieldName"]);_definedOptionalOutputs.sort()}}jQuery("#output-field-cntrl-"+f+" option[value='"+a+"']").remove();jQuery("#output-field-cntrl-"+f).val("no-value");if(f===3){var e=jQuery("#new-recommended-row");e.append(b);e.show()}else{if(f===4){jQuery("#new-optional-row").append(b)}}}function wppfm_activateCustomFieldRow(c){if(!_feedHolder.checkIfCustomNameExists(c)){var b=_feedHolder.getAttributeIdByName(c);var a=jQuery("#new-custom-row");_feedHolder.addAttribute(b,c,"",undefined,"5",true,0,0,0,0);a.append(wppfm_fieldRow(_feedHolder.attributes[b],true));a.show()}else{alert(wppfm_feed_settings_form_vars.duplicated_field.replace("%fieldname%",c))}jQuery("#custom-output-title-input").val("")}function wppfm_setStaticValue(b,a,d){var c=jQuery("#static-input-field-"+b+"-"+a+"-"+d).val();if(c===undefined){c=jQuery("#static-condition-input-"+b+"-"+a+"-"+d+" option:selected").val()}_feedHolder.setStaticAttributeValue(b,a,d,c)}function wppfm_setIdentifierExistsDependancies(){var a=jQuery("#static-input-field-34-0").val();if(a===undefined){a=jQuery("#static-condition-input-34-0 option:selected").val()}switch(a){case"true":wppfm_resetOutputField(12,1,true);wppfm_resetOutputField(13,1,true);break;case"false":wppfm_resetOutputField(12,3,false);wppfm_resetOutputField(13,3,false);break;default:break}}function wppfm_resetOutputField(b,f,c){var d=_feedHolder.attributes[b]["fieldLevel"];_feedHolder.attributes[b]["fieldLevel"]=f;_feedHolder.attributes[b]["isActive"]=c;var a=wppfm_fieldRow(_feedHolder.attributes[b],false);var e=_feedHolder.attributes[b]["fieldName"];if(c){jQuery("#required-field-table").append(a);jQuery("#output-field-cntrl-"+d+" option[value='"+e+"']").remove();jQuery("#recommended-field-table #row-"+b).remove()}else{jQuery("#row-"+b).replaceWith("");jQuery("#output-field-cntrl-"+f).append('<option value="'+e+'">'+e+"</option>")}}function wppfm_fieldRow(g,a){var h=g.rowId;var e=_feedHolder.getSourceObject(h);var c=countSources(e.mapping);if(e.advisedSource&&wppfm_hasExtraSourceRow(c,e.mapping)){c++}var f='<div class="field-table-row-wrapper" id="row-'+h+'">';for(var d=0;d<c;d++){f+=wppfm_addFeedSourceRow(h,d,e,_feedHolder.channel,a)}for(var b=0;b<e.changeValues.length;b++){if(e.changeValues[0]){f+=wppfm_valueEditor(e.rowId,b,b,e.changeValues)}}f+=wppfm_endrow(h);f+="</div>";return f}function wppfm_addSourceDataAndQueriesColumn(c,o){var k="";var d=o.rowId+"-"+c;var m=wppfm_getMappingSourceValue(o.mapping,c);var f=wppfm_getMappingCombinedValue(o.mapping,c);var h=wppfm_getMappingStaticValue(o.mapping,c);var b=!!o.customCondition;var a=!!(m||f||h);var g=_feedHolder.channel.toString();var l=wppfm_getMappingConditions(o.mapping,c);var n=wppfm_countObjectItems(l);k+='<div class="source-selector colw col30w" id="source-select-'+d+'">';if(b){k+=wppfm_categorySource()}else{if((o.advisedSource&&!a&&o.advisedSource!==wppfm_feed_settings_form_vars.fill_with_static_value)||o.advisedSource===m){var j=jQuery.grep(_inputFields,function(i){return i.value===o.advisedSource});j=j[0]?j[0].label:o.advisedSource;k+=wppfm_advisedSourceSelector(o.rowId,c,j,g,o.mapping)}else{if((!o.advisedSource&&!m)||a||o.advisedSource===wppfm_feed_settings_form_vars.fill_with_static_value){k+=wppfm_inputFieldCntrl(o.rowId,c,m,h,o.advisedSource,f,wppfm_isCustomChannel(g));if(h){k+=wppfm_feedStaticValueSelector(o.fieldName,o.rowId,c,0,h,g)}if(f){k+=wppfm_combinedField(o.rowId,c,0,f,false,g)}}}}k+="</div>";k+='<div class="condition-selector colw" id="condition-data-'+d+'">';if(!b&&!l){k+='<div class="condition-wrapper" id="condition-'+d+'-0">';k+=wppfm_forAllProductsCondition(o.rowId,c,"initial");k+="</div>"}else{if(l){for(var e=0;e<n;e++){k+=wppfm_conditionSelectorCode(o.rowId,c,e,n,l[e])}}}k+="</div>";return k}function wppfm_addCombinedField(b,a,j){var c=true;var g=jQuery("#combined-input-field-cntrl-"+b+"-"+a+"-"+j);for(var e=0;e<j;e++){if(g.val()==="select"){c=false;e=j}if(g.val()==="static"&&jQuery("#static-input-field-"+b+"-"+a+"-"+j).val()===""){c=false;e=j}}if(c){var f=_feedHolder.attributes[b]["value"]?JSON.parse(_feedHolder.attributes[b]["value"]):{};var h="m" in f?f.m:{};var d=wppfm_getMappingCombinedValue(h,a);var k=j>0;jQuery("#source-select-"+b+"-"+a).append(wppfm_combinedField(b,a,j,d,k));jQuery("#add-combined-field-"+b+"-"+a).hide()}else{alert(wppfm_feed_settings_form_vars.select_all_source_fields_warning)}}function wppfm_combinedField(c,a,j,e,l){jQuery("#combined-wrapper-"+c+"-"+a).remove();var f=wppfm_splitCombinedFieldElements(e);var k=e?f.length:2;if(l){k++}var h='<div class="combined-wrapper" id="combined-wrapper-'+c+"-"+a+'">';for(var d=0;d<k;d++){var g=f[d];var b=g?g.indexOf("#"):0;var m;if(g){m=g.substr(0,b)!=="static"?[g.substr(0,b),g.substr(b+1)]:["0",f[d]]}else{m=[]}h+=wppfm_combinedCntrl(c,a,d+1,k,"delete",m,_feedHolder.channel)}h+="</div>";return h}function wppfm_combinedCntrl(b,a,d,c,g,h,e){var f="";var i=_feedHolder.attributes[b]["fieldName"];f+='<span class="combined-field-row" id="combined-field-row-'+b+"-"+a+"-"+d+'">';if(d>1){f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0])}f+=wppfm_combinedInputFieldCntrl(b,a,d,h[1],i,e);if(g==="initialize"){f+='<span class="combined-field-row" id="combined-field-row">';f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0]);f+=wppfm_combinedInputFieldCntrl(b,a,2,"",i,e);f+='<div class="static-value-control" id="static-value-control-'+b+"-"+a+'-2"></div>'}if(d>2){f+='<span id="remove-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="remove-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_removeCombinedField('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.remove+"</a>)</span>"}if(d===2||d>=c){if(d===1){d++}if(d>=c){f+='<span id="add-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="add-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_addCombinedField('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.add+"</a>)</span>"}}f+="</span>";return f}function wppfm_ifConditionSelector(c,b,h,a,g){var d="";var e=wppfm_isEmptyQueryObject(g)?wppfm_makeCleanQueryObject():g;var i=wppfm_feed_settings_form_vars.if_pref+" ";if(h>1){i=e.preCondition==="1"?'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2">'+wppfm_feed_settings_form_vars.or+'</option><option value="1" selected>'+wppfm_feed_settings_form_vars.and+"</option></select>":'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2" selected>'+wppfm_feed_settings_form_vars.or+'</option><option value="1">'+wppfm_feed_settings_form_vars.and+"</option></select>"}var f="wppfm_storeCondition("+c+", "+b+", "+h+")";d+='<div class="condition-wrapper" id="condition-'+c+"-"+b+"-"+h+'">';d+=i;d+=wppfm_conditionFieldCntrl(c,b,h,-1,"input-field-cntrl",e.source,f);d+=wppfm_conditionQueryCntrl(c,b,h,-1,"query-condition","wppfm_queryConditionChanged",e.condition);d+='<input type="text" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" name="condition-value" id="condition-value-';d+=c+"-"+b+"-"+h+'" value="'+e.value+'"';if(g.condition!=="4"&&g.condition!=="5"){d+=' style="display:initial">'}else{d+=' style="display:none;">'}if(g.condition!=="14"){d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:none;"> '+wppfm_feed_settings_form_vars.and+' <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'"></span>'}else{d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:initial"> '+wppfm_feed_settings_form_vars.and+' <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'" value="'+g.endValue+'"></span>'}d+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+c;d+='" onclick="wppfm_removeCondition('+c+", "+b+", "+(h-1)+')">'+wppfm_feed_settings_form_vars.remove+"</a>)";if(h>=a){d+='<span id="add-edit-condition-'+c+"-"+b+"-"+h+'" style="display:initial"> (<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';d+='" onclick="wppfm_addCondition('+c+", "+b+", "+h+", '')\">"+wppfm_feed_settings_form_vars.add+"</a>)</span>"}d+="</div>";return d}function wppfm_orConditionSelector(d,b){var c=b.split("#");var e="";var a="";if(c[0]==="static"){e=wppfm_displayCorrectStaticField(d,"1","0",_feedHolder.channel,_feedHolder.attributes[d]["fieldName"],c[1]);b="static"}a+="or ";a+=wppfm_alternativeInputFieldCntrl(d,b);a+='<span id="alternative-static-input-'+d+'">'+e+"</span>";a+=" for all other products ";a+='(<a class="edit-prod-source wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-prod-source-'+d+'" onclick="addSource('+d+", 0, '')\">";a+=wppfm_feed_settings_form_vars.edit+"</a>)";return a}function wppfm_ifValueQuerySelector(b,a,d,h,g){var e="";var f=wppfm_isEmptyQueryObject(h)?wppfm_makeCleanQueryObject():h;var c="if ";var i="wppfm_queryValueConditionChanged("+b+", "+a+", "+d+", 0)";if(d>1){c=f.preCondition==="1"?'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2">'+wppfm_feed_settings_form_vars.or+'</option><option value="1" selected>'+wppfm_feed_settings_form_vars.and+"</option></select>":'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2" selected>'+wppfm_feed_settings_form_vars.or+'</option><option value="1">'+wppfm_feed_settings_form_vars.and+"</option></select>"}e+='<div class="value-options-query-selector" id="value-options-condition-'+b+"-"+a+"-"+d+'">';e+=c;e+=wppfm_conditionFieldCntrl(b,a,d,-1,"value-options-input-field-cntrl",f.source,i);e+=wppfm_conditionQueryCntrl(b,a,d,0,"value-query-condition","wppfm_queryValueConditionChanged",f.condition);if(h.condition!=="4"&&h.condition!=="5"){e+='<input type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-options-condition-value" id="value-options-condition-value-';e+=b+"-"+a+"-"+d+'" value="'+f.value+'" style="display:initial">'}if(h.condition!=="14"){e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:none;"> '+wppfm_feed_settings_form_vars.and+" ";e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value"></span>'}else{e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:initial"> '+wppfm_feed_settings_form_vars.and+" ";e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value" value="'+h.endValue+'"></span>'}e+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+b;e+='" onclick="wppfm_removeValueQuery('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.remove+"</a>)";if(g){e+='<span id="value-options-add-edit-condition-'+b+"-"+a+"-"+d+'" style="display:initial">(<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';e+='" onclick="wppfm_addValueQuery('+b+", "+a+", "+d+", '')\">"+wppfm_feed_settings_form_vars.add+"</a>)</span>"}e+="</div>";return e}function wppfm_addOptionalFieldRow(c){var b="";var a=false;if(c===3){a=_undefinedRecommendedOutputs.length>0}else{if(c===4){a=_undefinedOptionalOutputs.length>0}else{if(c===5){a=true}}}if(a===true){if(c===3){b+='<div class="field-table-row-wrapper" id="new-recommended-row" style="display:none;"></div>'}else{if(c===4){b+='<div class="field-table-row-wrapper" id="new-optional-row"></div>'}else{if(c===5){b+='<div class="field-table-row-wrapper" id="new-custom-row"></div>'}}}b+='<div class="field-table-row-top">';b+='<div class="col2w" id="output-select-'+c;b+=c!==5?'" onchange="wppfm_changedOutputSelection('+c+')">'+wppfm_outputFieldCntrl(c):'">'+wppfm_customOutputFieldCntrl();b+="</div></div>"}return b}function wppfm_editOutput(c,b){var a="";a+=wppfm_inputFieldCntrl(c,b,"","",_feedHolder.attributes[c]["advisedSource"],"",false);a+='<div class="field-table-row-combined-selection" id="combined-selectors-'+c+'" style="display:none;"></div>';jQuery("#source-select-"+c+"-"+b).html(a)}function wppfm_removeCondition(g,f,a){_feedHolder.removeValueConditionValue(g,f,a);var b=_feedHolder.getAttributesQueriesObject(g,f);var e=wppfm_countObjectItems(b);for(var d=1;d<e+2;d++){jQuery("#condition-"+g+"-"+f+"-"+d).remove()}if(e>0){for(var c=0;c<e;c++){wppfm_conditionCode(g,f,c,b[c],e)}jQuery("#edit-conditions-"+g).append(wppfm_orSelectorCode(g,""))}else{var h='<div class="condition-wrapper" id="condition-'+g+"-"+f+'-0">'+wppfm_forAllProductsCondition(g,f,"initial")+"</div>";jQuery("#condition-data-"+g+"-"+f).html(h);jQuery("#source-"+g+"-"+(f+1)).remove()}}function wppfm_removeValueQuery(f,e,d){_feedHolder.removeValueQueryValue(f,e,d);var a=_feedHolder.getValueQueryValue(f,e);var g=jQuery("#edit-conditions-"+f);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[f]["value"]){_feedHolder.deactivateAttribute(f)}jQuery("#value-editor-queries-"+f+"-"+e+"-0").empty();g.empty();if(c>0){for(var b=0;b<c;b++){wppfm_addValueQuery(f,e,b,a[b])}g.append(wppfm_orSelectorCode(f,""))}else{jQuery("#value-editor-input-query-span-"+f+"-"+e+"-0").show();_feedHolder.removeEditValueValue(f,(e+1),0);jQuery("#edit-value-span-"+f+"-"+(e+1)+"-0").remove()}}function wppfm_removeRow(c,e){var b=_definedRecommendedOutputs.indexOf(e);var d=3;if(b<0){b=_definedOptionalOutputs.indexOf(e);d=4}_feedHolder.deactivateAttribute(c);jQuery("#row-"+c).remove();if(d===3){_definedRecommendedOutputs.splice(b,1);_undefinedRecommendedOutputs.push(e);_undefinedRecommendedOutputs.sort()}else{if(d===4){_definedOptionalOutputs.splice(b,1);_undefinedOptionalOutputs.push(e);_undefinedOptionalOutputs.sort()}}var a=jQuery("#output-field-cntrl-"+d);a.empty();a.html(wppfm_outputFieldCntrl(d))}function wppfm_addCondition(d,c,a,b){var e=wppfm_conditionCode(d,c,a,b,0);if(e){if(a===0){jQuery(wppfm_addFeedSourceRow(d,c+1,_feedHolder.getSourceObject(d))).insertAfter("#source-"+d+"-"+c,false)}if(_feedHolder.attributes[d]["advisedSource"]){_feedHolder.setSourceValue(d,(c+1),_feedHolder.attributes[d]["advisedSource"])}}}function wppfm_conditionCode(c,a,i,g,d){if(g||wppfm_sourceIsFilled(c,a,i)){var j=jQuery("#query-condition-"+c+"-"+a+"-"+i).val();var b=jQuery("#input-field-cntrl-"+c+"-"+a+"-"+i).val();var f=jQuery("#condition-value-"+c+"-"+a+"-"+i).val();var e=false;if(j!=="4"&&j!=="5"&&j!=="14"){if(b==="select"||f===""){e=true}}else{if(j===4||j===5){if(b==="select"){e=true}}}if(e===false||i===0){_feedHolder.incrNrQueries(c);var h=wppfm_queryStringToQueryObject(g);if(i===0){jQuery("#condition-"+c+"-"+a+"-0").remove()}jQuery("#condition-data-"+c+"-"+a).append(wppfm_ifConditionSelector(c,a,i+1,d,h));if(i>0){jQuery("#add-edit-condition-"+c+"-"+a+"-"+i).remove()}return true}else{alert(wppfm_feed_settings_form_vars.fill_current_condition_warning);return false}}else{alert(wppfm_feed_settings_form_vars.select_a_source_field_warning);return false}}function wppfm_addValueQuery(d,a,f,h){if(wppfm_sourceIsFilled(d,a,f)){var i=jQuery("#value-query-condition-"+d+"-"+a+"-"+f+"-0").val();var c=jQuery("#value-options-input-field-cntrl-"+d+"-"+a+"-"+f).val();var g=jQuery("#value-options-condition-value-"+d+"-"+a+"-"+f).val();var e=false;if(i!=="4"&&i!=="5"&&i!=="14"){if(c==="select"||g===""){e=true}}else{if(i===4||i===5){if(c==="select"){e=true}}}if(e===false||a===0){var b=wppfm_queryStringToQueryObject(h);jQuery("#value-options-add-edit-condition-"+d+"-"+a+"-"+f).hide();jQuery("#value-editor-queries-"+d+"-"+a+"-0").append(wppfm_ifValueQuerySelector(d,a,f+1,b,true))}else{alert(wppfm_feed_settings_form_vars.fill_current_condition_warning)}}else{alert(wppfm_feed_settings_form_vars.elect_a_source_field_warning)}}function wppfm_conditionSelectorCode(f,d,e,a,c){var b=wppfm_queryStringToQueryObject(c);return wppfm_ifConditionSelector(f,d,e+1,a,b)}function wppfm_orSelectorCode(b,a){let alternative="";if(a){for(let altKey in a){alternative=a[altKey]}}return'<div class="or-selector" id="or-selector-'+b+'">'+wppfm_orConditionSelector(b,alternative)+"</div>"}function wppfm_showEditValueQuery(e,d,b,c){var a={};jQuery("#value-editor-queries-"+e+"-"+d+"-"+b).html(wppfm_ifValueQuerySelector(e,d,b+1,a,c));jQuery("#value-editor-input-query-span-"+e+"-"+d+"-0").hide();if(b===0&&c){wppfm_addRowValueEditor(e,d+1,0,"")}}function wppfm_changedOutput(e,a,l){var g=jQuery("#input-field-cntrl-"+e+"-"+a).val();var f=0;var b=jQuery("#source-select-"+e+"-"+a);var k=jQuery("#combined-wrapper-"+e+"-"+a);var d=jQuery("#static-input-field-"+e+"-"+a+"-"+f);var c=jQuery("#static-condition-input-"+e+"-"+a+"-"+f);switch(g){case"advised":if(e!==3){var i="";if(l!=="Use the settings in the Merchant Center"){var j=wppfm_sourceOptionsConverter(l);i='<div class="advised-source">'+j+wppfm_editSourceSelector(e,a)+"</div>"}else{i='<div class="advised-source">Use the settings in the Merchant Center '+wppfm_editSourceSelector(e,a)+"</div>"}b.html(i);_feedHolder.clearSourceValue(e,a);_feedHolder.deactivateAttribute(e)}else{i='<span id="category-source-string">'+_feedHolder.mainCategory+"</span>"+wppfm_editSourceSelector(e,a);_feedHolder.setCategoryValue(e,_feedHolder.mainCategory);b.html(i)}break;case"static":b.append(wppfm_displayCorrectStaticField(e,a,"0",_feedHolder.channel,_feedHolder.attributes[e]["fieldName"],""));k.remove();var h=d.val()?d.val():jQuery("#static-condition-input-"+e+"-"+a+"-"+f+" option:selected").val();_feedHolder.setStaticAttributeValue(e,a,f,h);if(h||a>0){_feedHolder.activateAttribute(e)}else{_feedHolder.deactivateAttribute(e)}break;case"select":_feedHolder.clearSourceValue(e,a);if(a==="0"){_feedHolder.deactivateAttribute(e)}d.remove();c.remove();k.remove();wppfm_clearStaticField(e);break;case"combined":_feedHolder.setSourceValue(e,a,g);if(a==="0"){_feedHolder.deactivateAttribute(e)}d.remove();c.remove();wppfm_addCombinedField(e,a,0);break;case"category_mapping":_feedHolder.setCustomCategory(e,_feedHolder.mainCategory);d.remove();c.remove();k.remove();jQuery("#condition-"+e+"-"+a+"-0").remove();jQuery("#value-editor-input-query-add-span-"+e+"-"+a+"-0").hide();b.html(wppfm_categorySource());break;default:jQuery("#static-input-"+e).html("");if(g===l&&a==="0"&&jQuery("#input-field-cntrl-"+e+"-"+a+"-0").val()==="select"){_feedHolder.clearSourceValue(e,a)}else{_feedHolder.setSourceValue(e,a,g)}_feedHolder.activateAttribute(e);_feedHolder.attributes[e]["isActive"]=true;d.remove();c.remove();k.remove();break}}function wppfm_changedAlternativeSource(d){var c="1";var a=jQuery("#alternative-input-field-cntrl-"+d).val();if(a==="static"){var b=wppfm_displayCorrectStaticField(d,c,"0",_feedHolder.channel,_feedHolder.attributes[d]["fieldName"],"");jQuery("#alternative-static-input-"+d).html(b)}else{jQuery("#alternative-static-input-"+d).empty();if(a!=="select"&&a!=="empty"){_feedHolder.setAlternativeSourceValue(d,c,a)}else{_feedHolder.removeAlternativeSourceValue(d,c)}}}function wppfm_changedCombinationSeparator(b,a,c){wppfm_changedCombinedOutput(b,a,c)}function wppfm_changedCombinedOutput(f,e,g){var c=jQuery("#combined-input-field-cntrl-"+f+"-"+e+"-"+g).val();var a=jQuery("#static-value-control-"+f+"-"+e+"-"+g);switch(c){case"static":if(!jQuery("#static-input-field-"+f+"-"+e+"-"+g).val()){var d=wppfm_displayCorrectStaticField(f,e,g,_feedHolder.channel,_feedHolder.attributes[f]["fieldName"],"");a.html(d)}break;default:a.empty();break}var b=getCombinedValue(f,e);if(b){_feedHolder.setCombinedOutputValue(f,e,b);_feedHolder.activateAttribute(f)}else{_feedHolder.removeCombinedOutputValue(f,e,g);if(e==="0"){_feedHolder.deactivateAttribute(f)}}}function wppfm_removeCombinedField(f,d,c){_feedHolder.removeCombinedOutputValue(f,d,c);var b=JSON.parse(_feedHolder.attributes[f]["value"]);var e="m" in b?b.m:{};var a=wppfm_getMappingCombinedValue(e,d);jQuery("#source-select-"+f+"-"+d).append(wppfm_combinedField(f,d,c,a,false))}function wppfm_clearStaticField(a){jQuery("#static-input-"+a).html("")}function wppfm_storeValueCondition(d,k,f){var a=jQuery("#value-options-input-field-cntrl-"+d+"-"+k+"-"+f).val();if(a!=="select"){var i;var j=f>1?jQuery("#value-options-sub-query-"+d+"-"+k+"-"+f+" option:selected").val():"0";var c=jQuery("#value-query-condition-"+d+"-"+k+"-"+f+"-0 option:selected").val();var h=c!=="4"&&c!=="5"?jQuery("#value-options-condition-value-"+d+"-"+k+"-"+f).val():"";var e=c==="14"?jQuery("#value-options-condition-and-value-input-"+d+"-"+k+"-"+f).val():"";if(c==="4"||c==="5"){i=true}else{if(c==="14"){i=!!(h&&e)}else{i=!!h}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+c;if(h){g+="#"+h}if(e){g+="#0#"+e}_feedHolder.addValueQueryValue(d,k,f,g)}}else{console.log("Query "+d+"-"+k+"-"+f+" removed!");_feedHolder.removeValueQueryValue(d,k,f)}}function wppfm_storeCondition(e,c,k){var a=jQuery("#input-field-cntrl-"+e+"-"+c+"-"+k).val();var l=false;if(wppfm_validSourceSelected(e,c)){if(a!=="select"){var i;var j=k>1?jQuery("#sub-condition-"+e+"-"+c+"-"+k+" option:selected").val():"0";var d=jQuery("#query-condition-"+e+"-"+c+"-"+k+" option:selected").val();var h=d!=="4"&&d!=="5"?jQuery("#condition-value-"+e+"-"+c+"-"+k).val():"";var f=d==="14"?jQuery("#condition-and-value-input-"+e+"-"+c+"-"+k).val():"";if(d==="4"||d==="5"){i=true}else{if(d==="14"){i=!!(h&&f)}else{i=!!(h)}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+d;if(h){g+="#"+h}if(f){g+="#0#"+f}_feedHolder.addConditionValue(e,g,c,k);l=true}}else{_feedHolder.removeValueConditionValue(e,c,k)}}else{jQuery("#input-field-cntrl-"+e+"-"+c+"-1").prop("selectedIndex",0);jQuery("#condition-value-"+e+"-"+c+"-1").val("");alert(wppfm_feed_settings_form_vars.select_a_valid_source_warning)}return l}function wppfm_validSourceSelected(d,c){var a=jQuery("#input-field-cntrl-"+d+"-"+c).val();switch(a){case"select":return false;case"static":var e=jQuery("#static-condition-input-"+d+"-"+c+"-0");var b=jQuery("#static-input-field-"+d+"-"+c+"-0");if(e.val()){return !!e.val()}else{if(b.val()){return !!b.val()}else{return false}}case"combined":return jQuery("#combined-input-field-cntrl-"+d+"-"+c+"-2").val()!=="select";default:return true}}function wppfm_valueInputOptionsChanged(d,b,g){var f=jQuery("#value-options-"+d+"-"+b+"-"+g+" option:selected").text();var h=jQuery("#value-options-input-"+d+"-"+b+"-"+g).val();var i="";var e=b>0?"and":"change";if(f!=="replace"&&f!=="recalculate"){i=e+"#"+f+"#";i+=f==="change nothing"?"blank":h;_feedHolder.addChangeValue(d,b,g,i)}else{if(f==="replace"){var a=jQuery("#value-options-input-with-"+d+"-"+b+"-"+g).val();if(h&&a){i=e+"#"+f+"#"+h+"#"+a;_feedHolder.addChangeValue(d,b,g,i)}}else{if(f==="recalculate"){var c=jQuery("#value-options-recalculate-options-"+d+"-"+b+"-"+g+" option:selected").text();if(h){i=e+"#"+f+"#"+c+"#"+h;_feedHolder.addChangeValue(d,b,g,i)}}}}}function wppfm_removeValueEditor(e,d,f){_feedHolder.removeEditValueValue(e,d,f);var a=_feedHolder.getAttributesValueObject(e);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[e]["value"]){_feedHolder.deactivateAttribute(e)}jQuery("#edit-value-span-"+e+"-"+d+"-0").remove();if(c>0){for(var b=1;b<c;b++){wppfm_addRowValueEditor(e,d,b,a[b])}}else{jQuery("#value-editor-"+e+"-"+d+"-"+f).remove();jQuery("#source-"+e+"-"+d).append(wppfm_editValueSpan(e,d,f,"initial"))}}function wppfm_makeFieldsTable(){var b=_feedHolder.channel.toString();wppfm_resetFields();for(var a=0;a<_feedHolder.attributes.length;a++){switch(_feedHolder.attributes[a]["fieldLevel"]){case"1":_mandatoryFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"2":_highlyRecommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"3":if(_feedHolder.attributes[a]["isActive"]){_recommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"4":if(_feedHolder.attributes[a]["isActive"]){_optionalFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"5":if(_feedHolder.attributes[a]["isActive"]){_customFields+=wppfm_fieldRow(_feedHolder.attributes[a],true)}else{_undefinedCustomOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;default:break}}_definedRecommendedOutputs.sort();_undefinedRecommendedOutputs.sort();_recommendedFields+=wppfm_addOptionalFieldRow(3);_optionalFields+=wppfm_addOptionalFieldRow(4);if(wppfm_isCustomChannel(b)){_customFields+=wppfm_addOptionalFieldRow(5)}if(_mandatoryFields.length>0){jQuery("#required-field-table").html(_mandatoryFields);jQuery("#required-fields").show()}else{jQuery("#required-fields").hide()}if(_highlyRecommendedFields.length>0){jQuery("#highly-recommended-field-table").html(_highlyRecommendedFields);jQuery("#highly-recommended-fields").show()}else{jQuery("#highly-recommended-fields").hide()}if(_recommendedFields.length>0){jQuery("#recommended-field-table").html(_recommendedFields);jQuery("#recommended-fields").show()}else{jQuery("#recommended-fields").hide()}if(_optionalFields.length>0){jQuery("#optional-field-table").html(_optionalFields);jQuery("#optional-fields").show()}else{jQuery("#optional-fields").hide()}if(_customFields.length>0){jQuery("#custom-field-table").html(_customFields);jQuery("#custom-fields").show()}else{jQuery("#custom-fields").hide()}jQuery("#fields-form").show(300)}function wppfm_resetFields(){_mandatoryFields=[];_highlyRecommendedFields=[];_recommendedFields=[];_undefinedRecommendedOutputs=[];_optionalFields=[];_undefinedOptionalOutputs=[];_customFields=[];_undefinedCustomOutputs=[]}function wppfm_queryConditionChanged(e,d,a){var c=jQuery("#query-condition-"+e+"-"+d+"-"+a).val();if(c==="4"||c==="5"){jQuery("#condition-value-"+e+"-"+d+"-"+a).hide()}else{jQuery("#condition-value-"+e+"-"+d+"-"+a).show()}if(c==="14"){jQuery("#condition-value-"+e+"-"+d+"-"+a).show();jQuery("#condition-and-value-"+e+"-"+d+"-"+a).show()}else{jQuery("#condition-and-value-"+e+"-"+d+"-"+a).hide()}var b=wppfm_storeCondition(e,d,a);if(b&&!jQuery("#source-"+e+"-"+(d+1)).length){jQuery(wppfm_addFeedSourceRow(e,d+1,_feedHolder.getSourceObject(e))).insertAfter("#source-"+e+"-"+d,false)}}function wppfm_queryValueConditionChanged(e,c,a,d){var b=jQuery("#value-query-condition-"+e+"-"+c+"-"+a+"-"+d).val();if(b==="4"||b==="5"){jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).hide()}else{jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).show()}if(b==="14"){jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).show();jQuery("#value-options-condition-and-value-"+e+"-"+c+"-"+a).show()}else{jQuery("#value-options-condition-and-value-"+e+"-"+c+"-"+a).hide()}wppfm_storeValueCondition(e,c,a)}function wppfm_getOutputFieldsList(d){var c="";var b=[];switch(d){case 3:b=_undefinedRecommendedOutputs;break;case 4:b=_undefinedOptionalOutputs;break;default:break}b.sort();for(var a=0;a<b.length;a++){c+='<option value="'+b[a]+'">'+b[a]+"</option>"}return c}function wppfm_fixedSourcesList(b){var d="";var c="";for(var a=0;a<_inputFields.length;a++){c=b===_inputFields[a].value?" selected":"";d+='<option value = "'+_inputFields[a].value+'" itemprop="'+_inputFields[a].prop+'" '+c+">"+_inputFields[a].label+"</option>"}return d}function wppfm_hideFeedFormMainInputs(){jQuery("#category-list-row").hide();jQuery("#aggregator-selector-row").hide();jQuery("#add-product-variations-row").hide()}function wppfm_editFeedFilter(){alert(wppfm_feed_settings_form_vars.advanced_filter_only_for_premium)}function wppfm_makeFeedFilterWrapper(a,b){var c=wppfm_feed_settings_form_vars.all_products_included;c+='<span id="filter-edit-text" style="display:initial;"> (<a class="edit-feed-filter wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-feed-filters-'+a;c+='" onclick="wppfm_editFeedFilter()">'+wppfm_feed_settings_form_vars.edit+"</a>)</span>";jQuery(".product-filter-condition-wrapper").html(c);jQuery(".main-product-filter-wrapper").show()}function wppfm_getCombinedSeparatorList(b){var a={"0":"-- "+wppfm_feed_settings_form_vars.no_separator+" --","1":wppfm_feed_settings_form_vars.space,"2":wppfm_feed_settings_form_vars.comma,"3":wppfm_feed_settings_form_vars.point,"4":wppfm_feed_settings_form_vars.semicolon,"5":wppfm_feed_settings_form_vars.colon,"6":wppfm_feed_settings_form_vars.dash,"7":wppfm_feed_settings_form_vars.slash,"8":wppfm_feed_settings_form_vars.backslash,"9":wppfm_feed_settings_form_vars.double_pipe,"10":wppfm_feed_settings_form_vars.underscore};var c="";for(var d in a){if(d!==b){c+='<option value="'+d+'">'+a[d]+"</option>"}else{c+='<option value="'+d+'" selected>'+a[d]+"</option>"}}return c}function updateFeedFormAfterInputChanged(a,b){wppfm_enableFeedActionButtons();wppfm_finishOrUpdateFeedPage(b);if(a===undefined||a<1){wppfm_constructNewFeed()}}jQuery(document).ready(function(){var a=wppfm_getUrlVariable("id");var b=wppfm_getUrlVariable("tab");_feedHolder=new Feed();if(""!==a&"product-feed"===b){wppfm_editExistingFeed(a)}});